# Instructions Détaillées pour Cursor - Étape 2.2.1

**Phase:** 2 - Collecte  
**Étape:** 2.2 - Module Traitement des Paiements  
**Fonctionnalité:** 2.2.1 - Configuration des Passerelles de Paiement  
**Prérequis:** Étape 2.1.4 complétée

---

## Contexte

Nous configurons les clients pour interagir avec les API de Stripe et PayPal. Cela inclut l'initialisation des SDK, la gestion des clés d'API, et la création de fonctions pour créer et confirmer les paiements.

**Référence cahier des charges:** Section 6.1 - Intégration des Plateformes de Paiement

---

## 1. Fichiers de Configuration

### Fichier Stripe

**Créer:** `/apps/web/lib/payment/stripe.ts`

- Initialiser le client Stripe avec la clé secrète
- Créer une fonction `createStripePaymentIntent` qui prend un montant et une devise, et retourne un `client_secret`
- Créer une fonction `confirmStripePayment` qui confirme le paiement avec l'ID du PaymentIntent

### Fichier PayPal

**Créer:** `/apps/web/lib/payment/paypal.ts`

- Configurer l'environnement PayPal (Sandbox ou Live)
- Créer une fonction `createPayPalOrder` qui prend un montant et une devise, et retourne un ID de commande
- Créer une fonction `capturePayPalPayment` qui capture le paiement avec l'ID de la commande

### Fichier d'Interface Unifiée

**Créer:** `/apps/web/lib/payment/index.ts`

- Exporter une interface unifiée pour interagir avec les deux passerelles de manière transparente

---

## 2. Variables d'Environnement

Ajouter les variables suivantes au fichier `.env` :

```
STRIPE_PUBLIC_KEY=pk_test_...
STRIPE_SECRET_KEY=sk_test_...
PAYPAL_CLIENT_ID=...
PAYPAL_CLIENT_SECRET=...
```

---

## 3. Dépendances NPM

```bash
npm install @stripe/stripe-js stripe @paypal/checkout-server-sdk
```

---

## 4. Vérifications Importantes

- ✅ Les clients Stripe et PayPal sont correctement initialisés
- ✅ Les fonctions de création de paiement fonctionnent pour les deux passerelles
- ✅ Les clés d'API sont correctement chargées depuis les variables d'environnement

---

## 5. Prochaine Étape

Une fois cette étape complétée, Manus préparera les instructions pour **2.2.2 - Webhooks et Confirmations**.

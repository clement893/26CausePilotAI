# Instructions Détaillées pour Cursor - Étape 1.1.3

**Phase:** 1 - Fondations  
**Étape:** 1.1 - Module Administration & Sécurité  
**Fonctionnalité:** 1.1.3 - Pages d'Authentification (UI)  
**Prérequis:** Étapes 1.1.1 et 1.1.2 complétées

---

## Contexte

Nous devons créer les interfaces utilisateur pour l'authentification : pages de login, register, error, et les composants de formulaires. Le design doit être moderne, responsive, et aligné avec le design system créé dans les pages DÉMO.

---

## 1. Page de Login

**Créer:** `/apps/web/app/[locale]/auth/login/page.tsx`

### Structure de la Page

La page doit contenir :

1. **Layout centré** avec une card glassmorphism
2. **Logo de l'organisation** en haut
3. **Titre** : "Connexion à Nucleus Cause"
4. **Formulaire de login** avec :
   - Champ Email (avec validation)
   - Champ Password (avec toggle show/hide)
   - Checkbox "Se souvenir de moi"
   - Bouton "Se connecter" (gradient bleu-violet)
   - Lien "Mot de passe oublié ?"
5. **Séparateur** : "Ou continuer avec"
6. **Bouton Google OAuth** (avec icône Google)
7. **Footer** : "Pas encore de compte ? S'inscrire"

### Fonctionnalités

- **Validation côté client** avec React Hook Form + Zod
- **Gestion des erreurs** affichées sous les champs
- **Loading states** pendant la soumission
- **Redirection** vers `/dashboard` après succès
- **Support des query params** : `?callbackUrl=/custom-page`
- **Messages d'erreur** clairs et en français

### Design

- Fond : Dark UI `#0A0A0F`
- Card : Glassmorphism avec `backdrop-blur-12px`
- Inputs : Glow effect au focus (bleu)
- Bouton principal : Gradient `from-blue-500 to-purple-500`
- Bouton Google : Bordure blanche avec hover fill
- Responsive : Mobile-first

---

## 2. Page de Register

**Créer:** `/apps/web/app/[locale]/auth/register/page.tsx`

### Structure de la Page

La page doit contenir :

1. **Layout centré** avec une card glassmorphism
2. **Logo de l'organisation** en haut
3. **Titre** : "Créer un compte"
4. **Formulaire de register** avec :
   - Champ Prénom (firstName)
   - Champ Nom (lastName)
   - Champ Email (avec validation)
   - Champ Password (avec force indicator)
   - Champ Confirm Password
   - Champ Nom de l'organisation (pour créer une nouvelle org)
   - Checkbox "J'accepte les conditions d'utilisation"
   - Bouton "Créer mon compte" (gradient bleu-violet)
5. **Séparateur** : "Ou continuer avec"
6. **Bouton Google OAuth** (avec icône Google)
7. **Footer** : "Déjà un compte ? Se connecter"

### Fonctionnalités

- **Validation côté client** avec React Hook Form + Zod
  - Email valide
  - Mot de passe minimum 8 caractères
  - Mot de passe contient : majuscule, minuscule, chiffre, caractère spécial
  - Confirmation de mot de passe match
- **Password strength indicator** (Weak, Medium, Strong)
- **Création automatique d'une organisation** avec slug généré
- **Envoi d'email de vérification** (optionnel pour plus tard)
- **Redirection** vers `/auth/welcome` après succès

### Logique de Création

Lors de la soumission, créer :
1. Une nouvelle `Organization` avec :
   - `name` = nom saisi
   - `slug` = généré depuis le nom (kebab-case)
   - `isActive` = true
2. Un nouveau `User` avec :
   - `email`, `firstName`, `lastName`
   - `password` = hashé avec bcrypt
   - `organizationId` = ID de l'org créée
   - `role` = ADMIN (premier utilisateur = admin)
   - `isActive` = true

---

## 3. Page d'Erreur

**Créer:** `/apps/web/app/[locale]/auth/error/page.tsx`

### Structure de la Page

La page doit contenir :

1. **Layout centré** avec une card
2. **Icône d'erreur** (rouge, grande taille)
3. **Titre** : "Erreur d'authentification"
4. **Message d'erreur** dynamique selon le type :
   - `CredentialsSignin` : "Email ou mot de passe incorrect"
   - `OAuthAccountNotLinked` : "Ce compte email est déjà utilisé avec une autre méthode de connexion"
   - `EmailSignin` : "Erreur lors de l'envoi de l'email de vérification"
   - `Callback` : "Erreur lors de la connexion"
   - `Default` : "Une erreur est survenue. Veuillez réessayer."
5. **Bouton** : "Retour à la connexion"

### Fonctionnalités

- Récupérer le type d'erreur depuis les query params : `?error=CredentialsSignin`
- Afficher le message approprié
- Logger l'erreur côté serveur pour debugging

---

## 4. Page de Bienvenue (Onboarding)

**Créer:** `/apps/web/app/[locale]/auth/welcome/page.tsx`

### Structure de la Page

La page doit contenir :

1. **Layout centré** avec animation d'entrée
2. **Icône de succès** (vert, grande taille)
3. **Titre** : "Bienvenue sur Nucleus Cause !"
4. **Message** : "Votre compte a été créé avec succès. Vous pouvez maintenant commencer à gérer vos campagnes de collecte de fonds."
5. **3 cartes de fonctionnalités** (quick tour) :
   - "Gérez vos donateurs" (icône Users)
   - "Créez des campagnes" (icône Target)
   - "Analysez vos résultats" (icône BarChart)
6. **Bouton** : "Accéder au tableau de bord" (gradient)

### Fonctionnalités

- Accessible uniquement après register
- Animation d'entrée (fade + slide)
- Redirection vers `/dashboard` après 5 secondes (auto) ou clic

---

## 5. Composants Réutilisables

### 5.1 Composant AuthCard

**Créer:** `/apps/web/components/auth/AuthCard.tsx`

Card réutilisable pour toutes les pages d'auth avec :
- Glassmorphism effect
- Padding généreux
- Max-width responsive
- Logo en haut
- Children pour le contenu

### 5.2 Composant AuthInput

**Créer:** `/apps/web/components/auth/AuthInput.tsx`

Input personnalisé avec :
- Label
- Placeholder
- Type (text, email, password)
- Error message
- Glow effect au focus
- Icon optionnel (left)
- Toggle show/hide pour password

### 5.3 Composant AuthButton

**Créer:** `/apps/web/components/auth/AuthButton.tsx`

Bouton personnalisé avec :
- Variants : primary (gradient), outline, google
- Loading state (spinner)
- Disabled state
- Full width option
- Icon optionnel

### 5.4 Composant PasswordStrengthIndicator

**Créer:** `/apps/web/components/auth/PasswordStrengthIndicator.tsx`

Indicateur de force du mot de passe avec :
- Barre de progression colorée (rouge → jaune → vert)
- Label (Faible, Moyen, Fort)
- Calcul basé sur :
  - Longueur (min 8)
  - Majuscules
  - Minuscules
  - Chiffres
  - Caractères spéciaux

---

## 6. Schémas de Validation Zod

**Créer:** `/apps/web/lib/validations/auth.ts`

### Schema Login

```typescript
import { z } from "zod"

export const loginSchema = z.object({
  email: z.string().email("Email invalide"),
  password: z.string().min(1, "Mot de passe requis"),
  remember: z.boolean().optional(),
})

export type LoginInput = z.infer<typeof loginSchema>
```

### Schema Register

```typescript
export const registerSchema = z.object({
  firstName: z.string().min(2, "Prénom trop court"),
  lastName: z.string().min(2, "Nom trop court"),
  email: z.string().email("Email invalide"),
  password: z
    .string()
    .min(8, "Minimum 8 caractères")
    .regex(/[A-Z]/, "Doit contenir une majuscule")
    .regex(/[a-z]/, "Doit contenir une minuscule")
    .regex(/[0-9]/, "Doit contenir un chiffre")
    .regex(/[^A-Za-z0-9]/, "Doit contenir un caractère spécial"),
  confirmPassword: z.string(),
  organizationName: z.string().min(2, "Nom d'organisation trop court"),
  acceptTerms: z.boolean().refine((val) => val === true, {
    message: "Vous devez accepter les conditions",
  }),
}).refine((data) => data.password === data.confirmPassword, {
  message: "Les mots de passe ne correspondent pas",
  path: ["confirmPassword"],
})

export type RegisterInput = z.infer<typeof registerSchema>
```

---

## 7. Actions Serveur

### 7.1 Action de Login

**Créer:** `/apps/web/app/actions/auth/login.ts`

```typescript
"use server"

import { signIn } from "@/lib/auth"
import { loginSchema, LoginInput } from "@/lib/validations/auth"

export async function loginAction(data: LoginInput) {
  // Valider les données
  const validated = loginSchema.parse(data)
  
  // Tenter la connexion avec Next-Auth
  const result = await signIn("credentials", {
    email: validated.email,
    password: validated.password,
    redirect: false,
  })
  
  if (result?.error) {
    return { error: "Email ou mot de passe incorrect" }
  }
  
  return { success: true }
}
```

### 7.2 Action de Register

**Créer:** `/apps/web/app/actions/auth/register.ts`

```typescript
"use server"

import { prisma } from "@/lib/prisma"
import { hashPassword } from "@/lib/auth/password"
import { registerSchema, RegisterInput } from "@/lib/validations/auth"
import slugify from "slugify"

export async function registerAction(data: RegisterInput) {
  // Valider les données
  const validated = registerSchema.parse(data)
  
  // Vérifier que l'email n'existe pas déjà
  const existingUser = await prisma.user.findUnique({
    where: { email: validated.email },
  })
  
  if (existingUser) {
    return { error: "Cet email est déjà utilisé" }
  }
  
  // Créer l'organisation
  const organization = await prisma.organization.create({
    data: {
      name: validated.organizationName,
      slug: slugify(validated.organizationName, { lower: true, strict: true }),
      isActive: true,
    },
  })
  
  // Hasher le mot de passe
  const hashedPassword = await hashPassword(validated.password)
  
  // Créer l'utilisateur
  const user = await prisma.user.create({
    data: {
      email: validated.email,
      firstName: validated.firstName,
      lastName: validated.lastName,
      password: hashedPassword,
      organizationId: organization.id,
      role: "ADMIN", // Premier utilisateur = admin
      isActive: true,
    },
  })
  
  return { success: true, userId: user.id }
}
```

---

## 8. Dépendances NPM à Installer

**Exécuter dans `/apps/web`:**

```bash
npm install react-hook-form @hookform/resolvers zod slugify
npm install -D @types/slugify
```

---

## 9. Structure des Fichiers à Créer

```
/apps/web/
├── app/
│   ├── [locale]/
│   │   └── auth/
│   │       ├── login/
│   │       │   └── page.tsx
│   │       ├── register/
│   │       │   └── page.tsx
│   │       ├── error/
│   │       │   └── page.tsx
│   │       └── welcome/
│   │           └── page.tsx
│   └── actions/
│       └── auth/
│           ├── login.ts
│           └── register.ts
├── components/
│   └── auth/
│       ├── AuthCard.tsx
│       ├── AuthInput.tsx
│       ├── AuthButton.tsx
│       └── PasswordStrengthIndicator.tsx
└── lib/
    └── validations/
        └── auth.ts
```

---

## 10. Design System à Respecter

Utiliser les variables CSS créées dans `/styles/ui-revamp.css` :

- **Couleurs:**
  - Fond principal : `var(--bg-primary)` ou `#0A0A0F`
  - Fond card : `var(--bg-secondary)` ou `#13131A`
  - Texte : `var(--text-primary)` ou `#FFFFFF`
  - Texte secondaire : `var(--text-secondary)` ou `#9CA3AF`

- **Gradients:**
  - Bouton CTA : `var(--gradient-blue-purple)`
  - Success : `var(--gradient-green-cyan)`
  - Error : `var(--gradient-orange-red)`

- **Effets:**
  - Glassmorphism : `backdrop-filter: blur(12px)` + `rgba(28, 28, 38, 0.7)`
  - Glow focus : `box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3)`
  - Hover lift : `transform: translateY(-2px)`

---

## 11. Vérifications Importantes

Avant de finaliser, assurez-vous que :

- ✅ Les 4 pages d'auth sont créées (login, register, error, welcome)
- ✅ Les 4 composants réutilisables sont créés
- ✅ Les schémas de validation Zod sont définis
- ✅ Les actions serveur sont implémentées
- ✅ La validation côté client fonctionne (React Hook Form)
- ✅ Le design respecte le design system (dark UI, gradients, glassmorphism)
- ✅ Les pages sont responsive (mobile-first)
- ✅ Les messages d'erreur sont en français
- ✅ Les loading states sont présents
- ✅ Les dépendances NPM sont installées

---

## 12. Tests à Effectuer Après Implémentation

**Manus vérifiera que :**

1. La page `/auth/login` s'affiche correctement
2. Le formulaire de login valide les champs
3. La connexion avec email/password fonctionne
4. La page `/auth/register` s'affiche correctement
5. Le formulaire de register valide tous les champs
6. L'inscription crée bien une organisation et un utilisateur
7. La page `/auth/error` affiche les messages appropriés
8. La page `/auth/welcome` s'affiche après inscription
9. Le design est cohérent avec les pages DÉMO
10. Les pages sont responsive sur mobile

---

## 13. Prochaine Étape

Une fois cette étape complétée et pushée, **Manus préparera les instructions pour l'étape suivante : 1.1.4 - Interface d'Administration (Gestion des Utilisateurs)**.

---

## Référence Cahier des Charges

- Section 11.2.1 - Gestion des Utilisateurs et Permissions
- Section 13.4 - Règles de Sécurité
- Section 15.2 - Utilisabilité
